Problem 2 Part (b) - Detailed Step-by-Step Derivation
======================================================

Question: How do we get this factorization?

    P(X_k = x, X_{k+1} = x', Y_1,...,Y_t)
    = P(Y_1,...,Y_k, X_k = x)
      × P(X_{k+1} = x' | X_k = x)
      × P(Y_{k+1} | X_{k+1} = x')
      × P(Y_{k+2},...,Y_t | X_{k+1} = x')

----------------------------------------------------------------------

Key HMM Properties We'll Use:
1. Markov property: P(X_{k+1} | X_k, Y_1,...,Y_k) = P(X_{k+1} | X_k)
2. Observation independence: P(Y_k | X_k, X_{k-1},...) = P(Y_k | X_k)
3. Future observations depend only on current state (not past states/observations)

----------------------------------------------------------------------

DETAILED DERIVATION:

Starting with: P(X_k = x, X_{k+1} = x', Y_1,...,Y_t)

Step 1: Apply chain rule to separate observations into three groups
    - Past observations: Y_1,...,Y_k
    - Current observation: Y_{k+1}
    - Future observations: Y_{k+2},...,Y_t

    P(X_k = x, X_{k+1} = x', Y_1,...,Y_t)
    = P(X_k = x, X_{k+1} = x', Y_1,...,Y_k, Y_{k+1}, Y_{k+2},...,Y_t)

Step 2: Use chain rule to factor from right to left
    = P(Y_{k+2},...,Y_t | X_k = x, X_{k+1} = x', Y_1,...,Y_k, Y_{k+1})
      × P(Y_{k+1} | X_k = x, X_{k+1} = x', Y_1,...,Y_k)
      × P(X_{k+1} = x' | X_k = x, Y_1,...,Y_k)
      × P(X_k = x, Y_1,...,Y_k)

Step 3: Apply Markov property - Future only depends on current state

    P(Y_{k+2},...,Y_t | X_k = x, X_{k+1} = x', Y_1,...,Y_k, Y_{k+1})
    = P(Y_{k+2},...,Y_t | X_{k+1} = x')

    Reason: Given X_{k+1}, the future Y_{k+2},...,Y_t is independent of
            X_k and all past observations/states (Markov property)

Step 4: Apply observation model - Y_{k+1} only depends on X_{k+1}

    P(Y_{k+1} | X_k = x, X_{k+1} = x', Y_1,...,Y_k)
    = P(Y_{k+1} | X_{k+1} = x')

    Reason: In an HMM, observations only depend on the current state

Step 5: Apply Markov property - State transition only depends on previous state

    P(X_{k+1} = x' | X_k = x, Y_1,...,Y_k)
    = P(X_{k+1} = x' | X_k = x)

    Reason: State transitions in a Markov chain only depend on the
            immediately previous state, not on observations or older states

Step 6: Recognize the joint probability of past

    P(X_k = x, Y_1,...,Y_k)
    = P(Y_1,...,Y_k, X_k = x)

    Just reordering terms (joint probability is symmetric)

----------------------------------------------------------------------

Putting it all together (Steps 3-6 into Step 2):

    P(X_k = x, X_{k+1} = x', Y_1,...,Y_t)

    = P(Y_{k+2},...,Y_t | X_{k+1} = x')          [from Step 3]
      × P(Y_{k+1} | X_{k+1} = x')                 [from Step 4]
      × P(X_{k+1} = x' | X_k = x)                 [from Step 5]
      × P(Y_1,...,Y_k, X_k = x)                   [from Step 6]

Reordering (multiply in any order):

    = P(Y_1,...,Y_k, X_k = x)
      × P(X_{k+1} = x' | X_k = x)
      × P(Y_{k+1} | X_{k+1} = x')
      × P(Y_{k+2},...,Y_t | X_{k+1} = x')

----------------------------------------------------------------------

SUMMARY:

The key insight is using the HMM's conditional independence structure:

    1. Past observations Y_1,...,Y_k and state X_k are jointly captured
    2. State transition X_k → X_{k+1} only depends on X_k (Markov)
    3. Observation Y_{k+1} only depends on current state X_{k+1}
    4. Future Y_{k+2},...,Y_t only depends on current state X_{k+1}

This allows us to "peel off" each probability factor one by one,
conditioned only on what truly matters according to the HMM structure.

----------------------------------------------------------------------

GRAPHICAL ILLUSTRATION:

    Past          Current       Future
    ----          -------       ------
    Y_1...Y_k     Y_{k+1}       Y_{k+2}...Y_t
       ↑             ↑                ↑
       |             |                |
    X_k ----→ X_{k+1} ----→ ...

    α_k(x)        M_{x',y_{k+1}}    β_{k+1}(x')
    captures      captures this     captures this
    this part     emission          future part

The factorization naturally splits the probability into:
    - Past (captured by α)
    - Transition (T matrix)
    - Current emission (M matrix)
    - Future (captured by β)
